# Conv2d Reimagined: img2col, GEMM, Sparsity & Quantization

Проект по исследованию реализации алгоритмов Conv2D для CNN. 

Исследованы реализации различные алгоритмы в Pytorch на CPU и GPU, то в каких именно случаях применяют алгоритм.

В Pytorch Conv2D эвристически выбирается (в зависимости от размера фильтра, батча и процессора)

- алгоритм прямой свертки с SIMD-оптимизацией
- Im2Col + GEMM
- GEMM
- Winograd
- FFT


**В данном проекте реализован Im2Col + GEMM**

Для ускорения применены методы оптимизации такие как LSQ квантизация, структурная и неструктурная спарсификация

Результаты замеров скорости представлены ниже (отсортированы по avg_forward)


| id | name                               | batch_size | avg_forward | avg_backward | avg_forward_mem | avg_backward_mem | kernel_size | acc   |
|----|------------------------------------|------------|-------------|--------------|------------------|-------------------|-------------|--------|
| 4  | lenet_gemm                         | 4          | 0.000928    | 0.001275     | 1.853516         | 21.861816         | 7           | 9.67   |
| 16 | sparse_struct_lenet_kernel7_bs8    | 4          | 0.000968    | 0.001294     | 0.177246         | 18.099609         | 7           | 10.00  |
| 15 | sparse_struct_lenet_kernel5_bs64   | 64         | 0.000968    | 0.002434     | 2.767875         | 25.112090         | 5           | 10.00  |
| 17 | sparse_struct_lenet_kernel7_bs8    | 8          | 0.000991    | 0.001782     | 0.307129         | 18.977539         | 7           | 10.16  |
| 14 | sparse_lenet                       | 8          | 0.001343    | 0.001153     | 3.774414         | 22.777344         | 7           | 15.55  |
| 9  | lenet_quantized                    | 8          | 0.001472    | 0.002161     | 4.051270         | 24.876465         | 7           | 16.23  |
| 11 | sparse_lenet                       | 64         | 0.002352    | 0.001248     | 11.932296        | 48.602053         | 3           | 10.09  |
| 6  | lenet_quantized                    | 64         | 0.002447    | 0.002278     | 13.764826        | 49.068372         | 3           | 10.65  |
| 5  | lenet_quantized                    | 64         | 0.003408    | 0.002559     | 22.851633        | 49.169293         | 5           | 43.58  |
| 2  | lenet                              | 64         | 0.003614    | 0.001563     | 21.503353        | 62.385961         | 5           | 53.16  |
| 10 | sparse_lenet                       | 64         | 0.003733    | 0.001616     | 27.679736        | 51.011739         | 5           | 13.46  |
| 8  | lenet_quantized                    | 64         | 0.004433    | 0.003022     | 31.891326        | 69.823196         | 5           | 43.03  |
| 12 | sparse_lenet                       | 256        | 0.007883    | 0.002310     | 46.714256        | 76.491089         | 3           | 10.88  |
| 0  | lenet_gemm                         | 256        | 0.007950    | 0.002115     | 45.201894        | 80.231493         | 3           | 51.26  |
| 7  | lenet_quantized                    | 256        | 0.008269    | 0.003992     | 57.884523        | 86.689606         | 3           | 37.32  |
| 1  | lenet_gemm                         | 256        | 0.012788    | 0.002937     | 82.892209        | 130.121801        | 5           | 58.07  |
| 13 | sparse_lenet                       | 256        | 0.015948    | 0.004492     | 120.012695       | 277.131181        | 7           | 10.14  |
| 3  | lenet_gemm                         | 256        | 0.017947    | 0.003132     | 118.986383       | 166.278990        | 7           | 53.33  |


Для запуска зависимостей используется

```sh
poetry install pyproject.toml
```